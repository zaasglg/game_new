<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ª–æ–≤—É—à–∫–∏ - Chicken Road</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .demo-section { background: #f0f8ff; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .real-section { background: #f0fff0; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .result { background: #fff; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 3px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input { padding: 5px; margin: 5px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .status { font-weight: bold; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêî Chicken Road - –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ª–æ–≤—É—à–∫–∏</h1>
        
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ª–æ–≤—É—à–∫–∏ –∫–∞–∫ –¥–ª—è –¥–µ–º–æ —Ä–µ–∂–∏–º–∞ (–≤ JSON —Ñ–∞–π–ª–µ), —Ç–∞–∫ –∏ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö volurgame.users).</p>
        
        <div class="demo-section">
            <h2>üéÆ –î–µ–º–æ —Ä–µ–∂–∏–º</h2>
            <p>–î–ª—è –¥–µ–º–æ —Ä–µ–∂–∏–º–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª <code>demo_coefficients.json</code></p>
            
            <button onclick="testDemo('save')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–º–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</button>
            <button onclick="testDemo('load')">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</button>
            
            <div id="demoResult" class="result"></div>
        </div>
        
        <div class="real-section">
            <h2>üí∞ –†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</h2>
            <p>–î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö <code>volurgame.users.chicken_trap_coefficient</code></p>
            
            <label>User ID: <input type="number" id="realUserId" value="1" min="1"></label>
            <button onclick="testReal('save')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</button>
            <button onclick="testReal('load')">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</button>
            
            <div id="realResult" class="result"></div>
        </div>
        
        <div>
            <h2>üìä –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <button onclick="loadCurrentData()">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <div id="currentData"></div>
        </div>
        
        <div>
            <h2>üéØ –°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã</h2>
            <p>–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä–µ</p>
            
            <label>–†–µ–∂–∏–º: 
                <select id="gameMode">
                    <option value="demo">–î–µ–º–æ</option>
                    <option value="real">–†–µ–∞–ª—å–Ω—ã–π</option>
                </select>
            </label>
            <label>User ID (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ): <input type="number" id="gameUserId" value="1"></label>
            <button onclick="simulateGame()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É</button>
            
            <div id="gameResult" class="result"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // –î–µ–º–æ —Ç–µ—Å—Ç—ã
        function testDemo(action) {
            const coefficient = action === 'save' ? (Math.random() * 6 + 1.5).toFixed(2) : null;
            
            $.ajax({
                url: "/valorgames/hack/pe/db-chicken-api.php",
                type: "json",
                method: "post",
                data: {
                    action: action === 'save' ? 'update_chicken_coefficient' : 'get_chicken_coefficient',
                    coefficient: coefficient,
                    user_id: 'demo',
                    is_demo: 1
                },
                success: function(r) {
                    const result = typeof r == "string" ? JSON.parse(r) : r;
                    displayResult('demoResult', result, action === 'save' ? `–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ ${coefficient}` : '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞');
                },
                error: function(e) {
                    displayError('demoResult', e, '–î–µ–º–æ ' + action);
                }
            });
        }
        
        // –†–µ–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
        function testReal(action) {
            const userId = $('#realUserId').val();
            const coefficient = action === 'save' ? (Math.random() * 6 + 1.5).toFixed(2) : null;
            
            $.ajax({
                url: "/valorgames/hack/pe/db-chicken-api.php",
                type: "json",
                method: "post",
                data: {
                    action: action === 'save' ? 'update_chicken_coefficient' : 'get_chicken_coefficient',
                    coefficient: coefficient,
                    user_id: userId,
                    is_demo: 0
                },
                success: function(r) {
                    const result = typeof r == "string" ? JSON.parse(r) : r;
                    displayResult('realResult', result, action === 'save' ? `–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ ${coefficient} –¥–ª—è User ${userId}` : `–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –¥–ª—è User ${userId}`);
                },
                error: function(e) {
                    displayError('realResult', e, '–†–µ–∞–ª—å–Ω—ã–π ' + action);
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadCurrentData() {
            $.get('/valorgames/chicken-road/test_api.php')
                .done(function(data) {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data, 'text/html');
                    const tables = doc.querySelectorAll('table');
                    const preElements = doc.querySelectorAll('pre');
                    
                    let content = '<h3>–î–∞–Ω–Ω—ã–µ –∏–∑ volurgame.users:</h3>';
                    if (tables.length > 0) {
                        content += tables[0].outerHTML;
                    } else {
                        content += '<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</p>';
                    }
                    
                    content += '<h3>–î–µ–º–æ –¥–∞–Ω–Ω—ã–µ:</h3>';
                    if (preElements.length > 0) {
                        content += preElements[preElements.length - 1].outerHTML;
                    } else {
                        content += '<p>–î–µ–º–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω</p>';
                    }
                    
                    $('#currentData').html(content);
                })
                .fail(function() {
                    $('#currentData').html('<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>');
                });
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª–Ω–æ–π –∏–≥—Ä—ã
        function simulateGame() {
            const mode = $('#gameMode').val();
            const userId = mode === 'demo' ? 'demo' : $('#gameUserId').val();
            const isDemo = mode === 'demo' ? 1 : 0;
            
            $('#gameResult').html('<p>–°–∏–º—É–ª–∏—Ä—É–µ–º –∏–≥—Ä—É...</p>');
            
            // –®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è "–ª–æ–≤—É—à–∫–∏"
            const trapCoefficient = (Math.random() * 6 + 1.5).toFixed(2);
            
            // –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
            $.ajax({
                url: "/valorgames/hack/pe/db-chicken-api.php",
                type: "json",
                method: "post",
                data: {
                    action: 'update_chicken_coefficient',
                    coefficient: trapCoefficient,
                    user_id: userId,
                    is_demo: isDemo
                },
                success: function(r) {
                    const saveResult = typeof r == "string" ? JSON.parse(r) : r;
                    
                    // –®–∞–≥ 3: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –∏–≥—Ä–∞)
                    $.ajax({
                        url: "/valorgames/hack/pe/db-chicken-api.php",
                        type: "json",
                        method: "post",
                        data: {
                            action: 'get_chicken_coefficient',
                            user_id: userId,
                            is_demo: isDemo
                        },
                        success: function(r2) {
                            const loadResult = typeof r2 == "string" ? JSON.parse(r2) : r2;
                            
                            let gameHtml = '<h4>üéÆ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–≥—Ä—ã:</h4>';
                            gameHtml += `<p><strong>–†–µ–∂–∏–º:</strong> ${mode}</p>`;
                            gameHtml += `<p><strong>User ID:</strong> ${userId}</p>`;
                            gameHtml += `<p><strong>1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–æ–≤—É—à–∫–∏:</strong> –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç ${trapCoefficient}</p>`;
                            gameHtml += `<p><strong>2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</strong> <span class="${saveResult.success ? 'success' : 'error'}">${saveResult.success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'}</span></p>`;
                            gameHtml += `<p><strong>3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã:</strong> <span class="${loadResult.success ? 'success' : 'error'}">${loadResult.success ? '‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç ' + loadResult.coefficient : '‚ùå –û—à–∏–±–∫–∞'}</span></p>`;
                            
                            if (saveResult.success && loadResult.success && Math.abs(trapCoefficient - loadResult.coefficient) < 0.01) {
                                gameHtml += '<p class="success"><strong>üéâ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç.</strong></p>';
                            } else {
                                gameHtml += '<p class="error"><strong>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!</strong></p>';
                            }
                            
                            $('#gameResult').html(gameHtml);
                        },
                        error: function(e) {
                            displayError('gameResult', e, '–ó–∞–≥—Ä—É–∑–∫–∞ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–≥—Ä—ã');
                        }
                    });
                },
                error: function(e) {
                    displayError('gameResult', e, '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–≥—Ä—ã');
                }
            });
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function displayResult(elementId, result, action) {
            let html = `<h4>${action}</h4>`;
            html += `<p class="status ${result.success ? 'success' : 'error'}">–°—Ç–∞—Ç—É—Å: ${result.success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'}</p>`;
            html += `<p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${result.message || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è'}</p>`;
            if (result.coefficient) html += `<p><strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:</strong> ${result.coefficient}</p>`;
            if (result.user_id) html += `<p><strong>User ID:</strong> ${result.user_id}</p>`;
            if (result.mode) html += `<p><strong>–†–µ–∂–∏–º:</strong> ${result.mode}</p>`;
            if (result.database) html += `<p><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> ${result.database}</p>`;
            html += `<details><summary>–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç</summary><pre>${JSON.stringify(result, null, 2)}</pre></details>`;
            $('#' + elementId).html(html);
        }
        
        function displayError(elementId, error, action) {
            let html = `<h4>${action}</h4>`;
            html += `<p class="status error">–°—Ç–∞—Ç—É—Å: ‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p>`;
            html += `<p><strong>–û—à–∏–±–∫–∞:</strong> ${error.responseText || error.statusText || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>`;
            html += `<details><summary>–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏</summary><pre>${JSON.stringify(error, null, 2)}</pre></details>`;
            $('#' + elementId).html(html);
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        $(document).ready(function() {
            loadCurrentData();
            console.log('üêî Chicken Road - –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ª–æ–≤—É—à–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
    </script>
</body>
</html>
